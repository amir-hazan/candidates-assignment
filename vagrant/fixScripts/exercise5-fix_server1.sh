#!/bin/bash
#add fix to exercise5-server1 here

#CREATING NEW ID_RSA FILE AFTER SYSTEM STARTUP AND ADD THE PRIVATE KEY INTO THE FILE
sudo su - vagrant -c 'echo "-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAxyjsnYmaClOD8dSGd5za1CN1NmDoySD0T3SU1IZbQrXyPdL5
M/+gTCxam8FDgIBL41THF2f2s8WIWrPK+js8l2e/FbQ9Sj2WPGA4Yl+GnvqkGgEr
p5UAb+ndhCPauRZuUn1FdslkffElDaJhF7YhTtUIzCERar4XChsScIFNxdYUWMjq
0ivK/z8kQTaS6g+imxgqPvxHlH2H6MO6Td9C3WGYiNZ2Ny3vwpZRyX9/J3K31mmo
BgqoUmQ4ZLOeUwxcHz1VdzRKLrVdPvstAk3MjsupfBrusZlW3hQfuRtcWs2nj8oN
tk5Q9txNhi56F5GI9nCfehqilYobzM7mShnapwIDAQABAoIBAAhwYn5Wa1GOsmOX
5s7AtcERc5EHUDXdkJyhSwEqZEmSXh5ihy694TP5GSnKaarTROPwHrOOMzTw5NM7
FRm/UtTzj3RC++nebDRIu3rno1OvOS7k582lEaysUzebMVRwb+JM7pmW9QwlILXQ
MJ8Jl6W4fzPvHsbQITfLZ9+eiwYb9fn7wvWTA/EK6FC6Ftg8GZHsYNgLJPwd3Tfh
x6ag3Q1I1fx0SN4ZQmRS7zIJzIXJsbzuiQHE8mPmdmNn8sKgjVNmQprsmzhU5dfy
NbupYTAGJWo+N2/yiY48jfF7CBKYo0+s1cLBBYN6tEIYlgUiw6m8fM1/QT514QCw
ikBTGVkCgYEA8LJ5pARz/GOJVlF0y0HJ8JmK6QGw3OC0qVaaTDUMJVcMyvQE0C9+
xHLQZ7GOnZQmJXQLi9Ggn6kL4cF48cL/smv6v+EBmWIC0YU6hvwVUPvefxsVOnSX
DQIl2QkmMMCYAJc50GB7KtV58y2goUDDW49Dt9ThTJbnyXm/bqhw4I0CgYEA09Jm
DT+peIBYS4b/H3sDnbkZNuAwII+Rzblu45ijk7F8DJwTn7neI4OkxZcoauDOsJBA
P2RDTRPVUNePSQqJHjpCH3rMoKw8t1gH2HY3TFZr+QYRoCBvBXpjVeUPHZ/cDl/j
53S6JFUsK/6v8fBz8ixwbWiPdhoAficJqkEEXQMCgYAVW1Ctu/Nqpo5OCWY6jrjT
T1xi9lJyFsIQ8G06a86LFaE99M7khgJSffl96eREmRuVYSmRG2WMJRy3yEnp8aps
c2ZJVjalHGwxmQeraHyftel1D7sfd67baaBgFI697qjODJ0FnznugAiVCixhgnST
EDArBImFGTKxzsqsj+eMFQKBgQCDK9+WhL3lqVUEMGz8iakLmvxKRzqGb2HTC+nn
dzaU12wCQwTD/M3bIEKBOcIFrYFRRYMDvosOyCFpFpPcn3GaDmm0JM9jEEXpI9J3
8Xz9AOeMJn3zsyINOmUZY+egaMZVAHyZcGd06GmaNPWv1T930J0uo3lzoVZ8yJ/r
lqelEQKBgETXXWkEUzC56YLODC7dMYuKgab000fJBKW4+aT6DYiSUxsFggIPv6Wr
DVPWgDpm+blobjueaVx2B1F1xDPmFojTRtu5e4CzFvLINwTjTkAkuyjuGh9/8NlP
KhaVZDkTUjplbhQoXBV3yD60coJMeDL+6pbNetmeEG+31+giQH73
-----END RSA PRIVATE KEY-----" > /home/vagrant/.ssh/id_rsa'

#CREATING NEW ID_RSA.PUB FILE AFTER SYSTEM STARTUP AND ADD THE PUBLIC KEY INTO THE FILE
sudo su - vagrant -c 'echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDHKOydiZoKU4Px1IZ3nNrUI3U2YOjJIPRPdJTUhltCtfI90vkz/6BMLFqbwUOAgEvjVMcXZ/azxYhas8r6OzyXZ78VtD1KPZY8YDhiX4ae+qQaASunlQBv6d2EI9q5Fm5SfUV2yWR98SUNomEXtiFO1QjMIRFqvhcKGxJwgU3F1hRYyOrSK8r/PyRBNpLqD6KbGCo+/EeUfYfow7pN30LdYZiI1nY3Le/CllHJf38ncrfWaagGCqhSZDhks55TDFwfPVV3NEoutV0++y0CTcyOy6l8Gu6xmVbeFB+5G1xazaePyg22TlD23E2GLnoXkYj2cJ96GqKVihvMzuZKGdqn vagrant@server1" > /home/vagrant/.ssh/id_rsa.pub'

#ADD THE PUBLIC KEY INTO THE AUTHORIZED_KEYS FILE - TO ENABLE REMOTE CONNECTION
sudo su - vagrant -c 'cat /home/vagrant/.ssh/id_rsa.pub >> /home/vagrant/.ssh/authorized_keys'

#SETTING READ PERMISSIONS
sudo chmod 400 /home/vagrant/.ssh/id_rsa

#DISABLING SSH LOGIN PASSWORD REQUEST
sudo sed -i 's/PasswordAuthentication yes/PasswordAuthentication no/i' /etc/ssh/sshd_config
sudo sed -i '$ a StrictHostKeyChecking no' /etc/ssh/ssh_config

#RESTARTING SSH SERVICE
sudo service ssh restart